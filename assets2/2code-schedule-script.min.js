jQuery.noConflict(),moment.locale(settings.locale),function(a){a('.artist-row').magnificPopup({removalDelay:500,callbacks:{beforeOpen:function(){this.st.mainClass=this.st.el.attr('data-effect')}},midClick:!0,items:{src:'#tcode-popup-container',type:'inline'},closeMarkup:'<button title="%title%" type="button" class="mfp-close"></button>',prependTo:'.tcode-event-schedule'}),a('.tcode-event-schedule .dayTitle').each(function(){var c=moment(a(this).text().trim(),'YYYY-MM-DD'),b;a(this).hasClass('mobile')?(b='dddd'):(b=settings.dayFormat),a(this).html(c.format(b))}),a('.tcode-event-schedule .row-date').each(function(){var b=moment(a(this).text().trim(),'YYYY-MM-DD');a(this).html(b.format(settings.dateFormat))}),a('.tcode-event-schedule .time-starts, .tcode-event-schedule .time-ends').each(function(){var b=moment(a(this).text().trim(),'HH:mm');a(this).html(b.format(settings.timeFormat))}),a('.tcode-social-icon').off('click').on('click',function(a){console.log('test'),a.stopPropagation()});function b(){a('img.svg').each(function(){var b=a(this),d=b.attr('id'),c=b.attr('class'),e=b.attr('src');if(!e.match('.svg'))return;a.get(e,function(h){var e=a(h).find('svg'),g,f;typeof d!='undefined'&&(e=e.attr('id',d)),typeof c!='undefined'&&(c=c.replace('img-responsive ','').replace('center-block',''),e=e.attr('class',c+' replaced-svg')),e=e.removeAttr('height').removeAttr('width'),g=b.parent(),f=g.attr('class'),typeof f!='undefined'?f=f+' svgContainer':f='svgContainer',g.attr('class',f),e=e.removeAttr('xmlns:a'),b.replaceWith(e)},'xml')})}a.widget('2code.schedule',{widgetEventPrefix:'schedule:',schedule:[],mobileSchedule:[],locations:[],mobileLocations:[],locationElement:{},locationGrpElement:{},dayElement:{},dates:[],date:'',location:'',options:{showLocations:!0,keepAccordionsOpen:!1,openFirstAccordion:!1},expanding:!1,_create:function(){this.schedule=this.element.find('.scheduled-events.desktop'),this.mobileSchedule=this.element.find('.scheduled-events.mobile'),this.locations=this.element.find('.scheduled-locations.desktop'),this.mobileLocations=this.element.find('.scheduled-locations.mobile'),this.dates=this.element.find('.scheduled-days'),this.date=this.element.find('.scheduled-day.active').data('date'),this.location=this.element.find('.scheduled-location.active').data('location'),this.artists=this.schedule.find('.artist-row'),this.mobileArtists=this.mobileSchedule.find('.artist-row.mobile')},_init:function(){this._initDays(),this._initLocations(),this._initExcerpts(),this._initPopups(),this._filter(!0),settings.imageType==='svg'&&b()},_initDays:function(){var b=this;a('.scheduled-day').on('click',function(){if(a(this).hasClass('active')){a(this).hasClass('mobile')&&(b.date='unset',b._filter(!0));return}b.date=a(this).data('date'),b._filter(!0)})},_initLocations:function(){var b=this;a('.scheduled-location').on('click',function(){if(a(this).hasClass('active')){a(this).parent().hasClass('mobile')&&(b.location='#noloc#',b._showLocation(),b._filter());return}b.location=a(this).data('location'),b._showLocation(),b._filter()})},_showLocation:function(){var b=this;a('.scheduled-location.active').removeClass('active'),this.locations.find('.scheduled-location').each(function(){a(this).data('location')===b.location&&a(this).addClass('active')}),this.mobileLocations.find('.scheduled-location').each(function(){a(this).data('location')===b.location&&(a(this).addClass('active'),a(this).parent().data('date')===b.date&&(b.locationElement=a(this)))})},_initExcerpts:function(){var b=this;a('body').on('click','.scheduled-event',function(){if(a(this).hasClass('hideExcerpt'))return;b._switchExcerptState(a(this))}),a('body').on('click','.scheduled-event a',function(a){a.stopPropagation()}),this._expandFirstExcerpt()},_initPopups:function(){var b=this;a('body').on('click','.tcode-artist-popover-close',function(b){b.stopPropagation(),b.preventDefault(),a('#tcode-popup-container .scheduled-event').html(),a.magnificPopup.close()}),b.artists.each(function(){var b=a(this),c=b.find('.tcode-artist-popover');b.on('click',function(b){b.stopPropagation(),b.preventDefault(),a('#tcode-popup-container .scheduled-event').html(c.clone(!0,!0).removeClass('hidden'))})}),b.mobileArtists.each(function(){var b=a(this),c=b.find('.tcode-artist-popover');b.on('click',function(b){b.stopPropagation(),b.preventDefault(),a('#tcode-popup-container .scheduled-event').html(c.clone(!0,!0).removeClass('hidden'))})})},_expandFirstExcerpt:function(){var b,a;if(!this.options.openFirstAccordion)return;if(b=this.schedule.find('.scheduled-event.event-visible').first(),a=this.mobileSchedule.find('.scheduled-event.event-visible').first(),b.hasClass('hideExcerpt')||!b.hasClass('event-collapsed')||a.length>0&&(a.hasClass('hideExcerpt')||!a.hasClass('event-collapsed')))return;this._collapseExcerpts(),b.hasClass('event-collapsed')&&this._expandExcerpt(b),a.hasClass('event-collapsed')&&this._expandExcerpt(a)},_switchExcerptState:function(a){var b=a.hasClass('event-collapsed');this._collapseExcerpts(),b?this._expandExcerpt(a):this._collapseExcerpt(a)},_collapseExcerpts:function(){var b=this;if(this.options.keepAccordionsOpen)return;this.element.find('.event-expanded').each(function(){b._collapseExcerpt(a(this))})},_expandExcerpt:function(a){a.find('.event-icon i').switchClass('tcode-ico-grot-down','tcode-ico-grot-up').data('state','expanded'),a.find('.event-excerpt').slideDown(400,function(){console.log('test'),this.expanding=!1}),a.switchClass('event-collapsed','event-expanded')},_collapseExcerpt:function(a){a.find('.event-icon i').switchClass('tcode-ico-grot-up','tcode-ico-grot-down').data('state','collapsed'),a.find('.event-excerpt').slideUp(),a.switchClass('event-expanded','event-collapsed')},_filter:function(c){var b=this,d;c&&(b.dates.find('.scheduled-day').each(function(){a(this).data('date')===b.date&&!a(this).hasClass('active')?a(this).addClass('active'):a(this).data('date')!==b.date&&a(this).hasClass('active')&&a(this).removeClass('active'),a(this).hasClass('mobile')&&a(this).hasClass('active')&&(b.dayElement=a(this))}),b.options.showLocations&&(b._locationsFilter(b.locations),b._locationsFilter(b.mobileLocations))),b.schedule.find('.scheduled-event').each(function(){a(this).data('date')!==b.date||b.options.showLocations&&a(this).data('location').match(b.location)===null?a(this).slideUp().removeClass('event-visible').addClass('event-hidden'):a(this).slideDown().removeClass('event-hidden').addClass('event-visible')}),b.mobileSchedule.find('.scheduled-event').each(function(){var c,e,d,f;a(this).data('date')!==b.date||b.options.showLocations&&a(this).data('location').match(b.location)===null?(c=b.mobileLocations.find('.'+a(this).data('event')),c.length<=0&&(c=b.element.find('.scheduled-days .days-mobile .'+a(this).data('event'))),e=c.parent(),c.slideUp(400,function(){a(this).remove(),e.hasClass('location-events')&&e.find('.scheduled-event').length===0&&e.remove()})):(c=a(this).clone(!0,!0),b.options.showLocations?(b.locationElement.next().hasClass('location-events')?(d=b.locationElement.next()):(d=a('<div/>').addClass('location-events'),d.insertAfter(b.locationElement)),b.locationElement.length>0?c.appendTo(d):c.appendTo(b.locationGrpElement),f=setInterval(function(){b.mobileLocations.filter(':animated').length===0&&(c.slideDown(400),c.removeClass('event-hidden').addClass('event-visible'),clearInterval(f))},100)):(b.dayElement.next().hasClass('location-events')?(d=b.dayElement.next()):(d=a('<div/>').addClass('location-events col-xs-12'),d.insertAfter(b.dayElement)),c.appendTo(d),f=setInterval(function(){b.mobileLocations.filter(':animated').length===0&&(c.slideDown(400),c.removeClass('event-hidden').addClass('event-visible'),clearInterval(f))},100)))}),this._checkVisibleEvents(),d=setInterval(function(){a(':animated').length===0&&(b._expandFirstExcerpt(),clearInterval(d))},100)},_locationsFilter:function(c){var b=this;c.each(function(){a(this).data('date')!==b.date?a(this).slideUp().removeClass('locations-visible').addClass('locations-hidden'):a(this).slideDown().removeClass('locations-hidden').addClass('locations-visible')}),c.each(function(){var c=a(this),d;c.hasClass('locations-visible')&&(d=c.find('.scheduled-location').first(),c.find('.scheduled-location.active').removeClass('active'),d.addClass('active'),b.location=d.data('location'),c.hasClass('mobile')&&(b.locationElement=d,b.locationGrpElement=c))})},_checkVisibleEvents:function(){this.schedule.find('.event-visible').length===0?this.element.find('.no-events').slideDown():this.element.find('.no-events').slideUp()}})}(jQuery)